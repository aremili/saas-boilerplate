{% extends "base.html" %}
{% from "components/macros.html" import alert, badge, button, input, checkbox, number_input %}

{% block title %}Task Manager - HTMX + Shoelace Demo{% endblock %}

{% block content %}
<div class="min-h-screen">
    <div class="container p-8">

        {# Header #}
        <header class="mb-8">
            <h1 class="mb-2">Task Manager</h1>
            <p class="text-muted">
                Demo combining <strong>HTMX</strong> (server requests) +
                <strong>Shoelace</strong> (a11y components) + <strong>FastAPI</strong>
            </p>
        </header>

        {# Alert Container - Alerts are injected via HTMX OOB swaps #}
        <div id="alert-container" class="mb-6 space-y-3">
            {# Alerts will be inserted here via HTMX OOB swaps #}
        </div>

        {# Stats Card - Updates via HTMX after task changes #}
        <div id="task-stats" hx-get="/tasks/stats"
            hx-trigger="taskCreated from:body, taskDeleted from:body, taskToggled from:body" hx-swap="innerHTML">
            {% include "partials/task_stats.html" %}
        </div>

        {# Add Task Button - Opens Shoelace Dialog #}
        <div class="mb-6">
            <sl-button variant="primary" size="large" style="width: 100%"
                onclick="document.getElementById('add-task-dialog').show()">
                <sl-icon slot="prefix" name="plus-lg"></sl-icon>
                Add New Task
            </sl-button>
        </div>

        {# Add Task Dialog - Shoelace sl-dialog #}
        <sl-dialog id="add-task-dialog" label="Add New Task">
            <form id="add-task-form" hx-post="/tasks/" hx-target="#task-list" hx-swap="afterbegin"
                hx-on::after-request="this.reset(); document.getElementById('add-task-dialog').hide();">

                <div class="space-y-4">
                    <sl-input name="title" label="Task Title" placeholder="What needs to be done?" required>
                    </sl-input>

                    <div class="flex items-center gap-4">
                        {{ number_input("priority", label="Priority", min=1, max=5, value=2, help_text="1 = highest, 5 =
                        lowest") }}
                    </div>

                    <sl-divider></sl-divider>

                    {{ checkbox("completed", label="Mark as already completed") }}
                </div>

                <div slot="footer" class="flex gap-3 justify-end">
                    <sl-button variant="neutral" onclick="document.getElementById('add-task-dialog').hide()">
                        Cancel
                    </sl-button>
                    <sl-button variant="primary" type="submit">
                        Add Task
                    </sl-button>
                </div>
            </form>
        </sl-dialog>

        {# Task List - Main content area #}
        <sl-card class="mb-6">
            <div slot="header" class="flex items-center justify-between">
                <h2>Tasks</h2>
                <sl-button variant="text" size="small" hx-get="/tasks/list" hx-target="#task-list" hx-swap="innerHTML">
                    <sl-icon slot="prefix" name="arrow-clockwise"></sl-icon>
                    Refresh
                </sl-button>
            </div>

            <div id="task-list" class="task-list">
                {% include "partials/task_list.html" %}
            </div>
        </sl-card>

        {# Info Footer #}
        <footer class="mt-8 text-center text-sm text-muted">
            <p>
                <strong>HTMX</strong> handles form submissions &amp; list updates •
                <strong>Shoelace</strong> provides a11y components •
                <strong>FastAPI</strong> serves HTML partials
            </p>
        </footer>
    </div>
</div>
{% endblock %}